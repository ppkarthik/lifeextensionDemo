var stjude=stjude||{};
stjude.dprforms=stjude.dprforms||{};
stjude.dprforms.addressvalidation=(function(E){var O;
var R;
var V;
var m;
var J;
var a;
var e;
var H;
var c;
var T;
var L;
var X;
var f;
var s;
var S;
var q;
var ac;
var o=false;
var A=null;
var Z={type:"POST",dataType:"text json",timeout:10000,cache:false};
var K;
var h=function(ae,ad,ag){var af=JSON.stringify(ae);
E.ajax(E.extend({},Z,{async:ad,url:A,contentType:"application/json",data:af,success:function(ah){K=ag;
F();
if(ah){b(ah)
}else{r();
y();
if(typeof K!="undefined"&&l()){K()
}}},error:function(aj,ah,ai){K=ag;
F();
i();
r();
y();
if(typeof K!="undefined"&&l()){K()
}}}))
};
var t=function(ad){if(ad!==null&&ad.hasOwnProperty("address1")){O.data("corrected",ad.address1)
}else{O.data("corrected","")
}if(ad!==null&&ad.hasOwnProperty("address2")){R.data("corrected",ad.address2)
}else{R.data("corrected","")
}if(ad!==null&&ad.hasOwnProperty("city")){V.data("corrected",ad.city)
}else{V.data("corrected","")
}if(ad!==null&&ad.hasOwnProperty("state")){m.data("corrected",ad.state)
}else{m.data("corrected","")
}if(ad!==null&&ad.hasOwnProperty("zipCode")){J.data("corrected",ad.zipCode)
}else{J.data("corrected","")
}};
var M=function(ad,ae){if(a.val()=="CA"||a.val()=="CAN"){n();
if(typeof ae!="undefined"){ae()
}return
}if(E.trim(E(J).val()).replace(/_/g,"").length<5){return
}fieldsToCheck=[c,T,O,V,m];
if(!d(fieldsToCheck)){return
}Y();
Q();
ab();
X.hide();
I();
W();
h(v(),ad,ae)
};
var d=function(ad){var ae=true;
E(ad).each(function(ag,ah){var af=E.trim(ah.val());
if(af.length==0){ae=false
}});
return ae
};
var v=function(){return{firstName:c.val(),lastName:T.val(),address1:O.val(),address2:R.val(),city:V.val(),state:m.val(),zipCode:J.val()}
};
var b=function(ad){t(null);
switch(ad.status){case"VALID":t(ad.correctedAddress);
N();
if(typeof K!="undefined"&&l()){K()
}break;
case"MINOR_CHANGES":t(ad.correctedAddress);
j(ad.correctedAddress);
if(typeof K!="undefined"&&l()){K()
}break;
case"SUGGESTION":t(ad.correctedAddress);
if(ad.correctedAddress.address1.length<30){z(ad.correctedAddress);
Q()
}else{N();
if(typeof K!="undefined"&&l()){K()
}}break;
case"UNVERIFIABLE":D();
Q();
break;
case"UNAVAILABLE":p();
if(typeof K!="undefined"&&l()){K()
}break;
case"BAD_REQUEST":k();
if(typeof K!="undefined"&&l()){K()
}break;
default:p();
if(typeof K!="undefined"&&l()){K()
}}};
var n=function(){e.val("NON_US_ADDRESS");
F();
I();
r();
y()
};
var i=function(){e.val("UNAVAILABLE");
F();
r();
y()
};
var N=function(){e.val("VALID");
U();
r();
y()
};
var j=function(ad){e.val("MINOR_CHANGES");
U();
r();
y()
};
var z=function(ad){var af=function(ag){I();
U();
r();
y()
};
var ae=function(){B();
e.val("SUGGESTION_ACCEPTED");
O.val(ad.address1);
if(ad.address2){R.val(ad.address2)
}else{R.val("")
}V.val(ad.city);
m.val(ad.state);
J.val(ad.zipCode);
C();
af(ad);
r();
if(typeof K!="undefined"&&l()){K()
}return false
};
if(ad.address1.length>30){q.text(q.data("error-long"));
E("#leaveAsEntered").hide();
E("#leaveAsEnteredLong").show();
E("#suggestionButton").click(function(){e.val("TOO_LONG");
C();
P();
return false
})
}else{q.text(u(ad));
E("#suggestionButton").click(ae)
}E("#addrWithSuggestion").show();
E("#addrNoSuggestion").hide();
E("#selectValidAddress").show();
E("#notRecognizedaddress").hide();
G()
};
var D=function(){E("#addrWithSuggestion").hide();
E("#addrNoSuggestion").show();
E("#notRecognizedaddress").show();
X.fadeIn(200);
G()
};
var p=function(){e.val("UNAVAILABLE");
L.hide();
f.slideDown();
F();
r();
y()
};
var k=function(){e.val("BAD_REQUEST");
F();
r();
y()
};
var G=function(){var ad=u(v());
s.text(ad);
S.text(ad);
E("body").find("input, textarea, button, select").prop("disabled",true);
H.fadeTo("fast",0.3);
E(".suggest").addClass("fadeInUp").removeClass("fadeOutDown");
E(".suggest").show();
E("html,body").animate({scrollTop:E(".suggest").offset().top-20})
};
var C=function(){E("body").find("input, textarea, button, select").prop("disabled",false);
H.fadeTo("fast",1);
E(".suggest").removeClass("fadeInUp").addClass("fadeOutDown");
setTimeout(function(){E(".suggest").hide();
E("#editButton").show()
},200)
};
var u=function(ad){return ad.address1+" "+(ad.address2?ad.address2:"")+", "+ad.city+", "+ad.state+", "+ad.zipCode
};
var Q=function(){o=false
};
var y=function(){o=true
};
var U=function(){var ad=[O,R,V,m,J];
I();
E(".address-success").fadeIn();
E(ad).each(function(ae,af){E(af).addClass("highlight")
});
setTimeout(function(){E(ad).each(function(ae,af){E(af).removeClass("highlight",400)
});
E(".address-success").fadeOut(400)
},2000)
};
var W=function(){E(".address-oops").show()
};
var F=function(){E(".address-oops").fadeOut(200)
};
var I=function(){E(".address-oops").fadeOut(100);
E(".address-success").hide()
};
var w=function(){I();
r();
y()
};
var P=function(){I();
r();
y()
};
var x=function(){r();
Q()
};
var aa=function(){if(ac){M(false)
}else{e.val("SUGGESTION_REFUSED");
y()
}};
var l=function(){if(!H.is(":visible")){return true
}if(o){return true
}else{if(!L.is(":visible")){aa()
}if(o){return true
}else{window.scrollTo(0,O.offset().top);
return false
}}};
var g=function(ae,ad){if(ae.length){if(ad){E('<span class="address-success icon-checkmark"></span><span class="address-oops icon-spinner"></span>').insertAfter(ae)
}}};
function Y(){E("body").css("pointer-events","none");
E("#donationForm input:submit").prop("disabled",true)
}function r(){E("body").css("pointer-events","");
E("#donationForm input:submit").prop("disabled",false)
}function B(){E("#suggestion").css("pointer-events","none")
}function ab(){E("#suggestion").css("pointer-events","")
}return{init:function(ad){A=ad;
O=E("#notifyAddress1");
R=E("#notifyAddress2");
V=E("#notifyCity");
m=E("#notifyState");
J=E("#notifyZipPostalCode");
a=E("#notifyCountry");
e=E("#addressValidStatusRec");
H=E("#tributeAddressContainer");
c=E("#notifyFirstName");
T=E("#notifyLastName");
L=E("#suggestion");
X=E("#addressRefused");
f=E("#suggestionUnavailable");
s=E("#leaveAsEnteredButton .suggestedAddress");
S=E("#notRecognizedaddress .suggestedAddress");
q=E("#suggestionButton .suggestedAddress");
var ae=[c,T,O,R,V,m,J,a];
E(ae).each(function(af,ag){g(ag,true)
});
E("#leaveButton").click(function(){B();
e.val("SUGGESTION_REFUSED");
C();
w();
if(typeof K!="undefined"&&l()){K()
}return false
});
E("#editButton").click(function(){e.val("EDIT_ADDRESS");
C();
x();
E.publish("/dprforms/processing","false");
window.scrollTo(0,O.offset().top);
return false
});
E("#leaveAsEnteredButton").click(function(){B();
e.val("SUGGESTION_REFUSED");
C();
w();
if(typeof K!="undefined"&&l()){K()
}return false
})
},triggerAddressValidation:function(ad){o=false;
ac=true;
M(true,ad)
},resetZipCodeValidation:function(){J=E("#notifyZipPostalCode")
}}
})(jQuery);
var stjude=stjude||{};
stjude.dprforms=stjude.dprforms||{};
stjude.dprforms.shippingaddress=(function(c){var a=[];
var f=[];
var e={};
function g(){var l=0;
var k=0;
c("#notifyState > option").each(function(){var n=c(this).val();
var o=c(this).text();
var j=c(this).attr("class");
var m=c(this).attr("selected");
if(j=="US"){a[l]=[n,o,m];
l++
}if(j=="CA"){f[k]=[n,o,m];
k++
}})
}function b(m){var p=m;
if(p=="US"){var l=c("#shipAddressZip").data("zipcodelabel");
var o=c(".notifyStateFieldWrapper").data("statelabel");
opttext="";
for(var k in a){if(a[k][2]){opttext+="<option value='"+a[k][0]+"' selected disabled>"+a[k][1]+"</option>"
}else{if(!c.trim(a[k][0])&&a[k][1]){opttext+="<option value=' ' disabled>"+a[k][1]+"</option>"
}else{if(a[k][0]&&a[k][1]){opttext+="<option value="+a[k][0]+">"+a[k][1]+"</option>"
}}}}c("#notifyState").html(opttext);
c("#notifyStateLabel").html('<span class="requiredMark">* </span>'+o);
c("#notifyZipPostalCodeLabel").html('<span class="requiredMark">* </span>'+l);
c("#notifyZipPostalCode").attr("pattern","[0-9]*");
c("#notifyZipPostalCode").attr("maxlength","5");
if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1){c("#notifyZipPostalCode").clone().attr("type","text").insertAfter("#notifyZipPostalCode").prev().remove()
}else{c("#notifyZipPostalCode").clone().attr("type","number").insertAfter("#notifyZipPostalCode").prev().remove()
}c("#notifyZipPostalCode").on("keyup keypress blur change",function(r){if(c(this).val().length>0){if(c(this).val().length>=parseInt(c(this).attr("maxlength"))&&(r.which!=8&&r.which!=0)){return false
}}});
if(typeof c("#notifyZipPostalCode").unmask()!=="undefined"){c("#notifyZipPostalCode").unmask()
}i()
}else{if(p=="CA"){var q=c(".notifyZipPostalCode").data("postcodelabel");
var n=c(".notifyStateFieldWrapper").data("provincelabel");
opttext="";
opttext+='<option value="" >---</option>';
for(var j in f){if(f[j][0]&&f[j][1]){opttext+="<option value="+f[j][0]+">"+f[j][1]+"</option>"
}}c("#notifyState").html(opttext);
c("#notifyStateLabel").html('<span class="requiredMark">* </span>'+n);
c("#notifyZipPostalCodeLabel").html('<span class="requiredMark">* </span>'+q);
c("#notifyZipPostalCode").attr("pattern","");
c("#notifyZipPostalCode").attr("maxlength","8");
c("#notifyZipPostalCode").clone().attr("type","text").insertAfter("#notifyZipPostalCode").prev().remove();
i();
if(typeof c("#notifyZipPostalCode").unmask()!=="undefined"){c("#notifyZipPostalCode").unmask()
}stjude.dprforms.mask.maskZip(p,c("#notifyZipPostalCode"))
}}stjude.dprforms.addressvalidation.resetZipCodeValidation();
c.publish("/dprforms/formUpdate")
}function i(){c("#notifyZipPostalCode").rules("add",{required:true,notifyZipCode:true,minlength:5,messages:{required:e.notifyZipPostalCode,notifyZipCode:e.notifyZipPostalCode,minlength:e.notifyZipPostalCode,pattern:e.notifyZipPostalCode}})
}function d(){jQuery.validator.addMethod("notifyZipCode",function(l,j){var k;
if(jQuery("#notifyCountry").val()=="CA"){k=/^[a-zA-Z]\d[a-zA-Z] \d[a-zA-Z]\d$/
}else{k=/^[0-9]{5}$/
}return this.optional(j)||k.test(l)
},"zip code is not formatted correctly.");
if(c("#notifyCountry").val()=="US"){e.notifyZipPostalCode=c(".notifyZipPostalCode").data("ziperror");
e.notifyState=c(".notifyState").data("stateerror")
}else{e.notifyZipPostalCode=c(".notifyZipPostalCode").data("postalerror");
e.notifyState=c(".notifyState").data("provinceerror")
}c("#notifyAddress1").rules("add",{required:true,cybersource:true,noEmoji:true,messages:{required:e.notifyAddress1}});
c("#notifyAddress2").rules("add",{required:false,cybersource:true,noEmoji:true,messages:{required:e.notifyAddress1}});
c("#notifyCity").rules("add",{required:true,hasLetters:true,cybersource:true,noEmoji:true,messages:{required:e.notifyCity,hasLetters:e.notifyCity}});
c("#notifyState").rules("add",{required:true,messages:{required:e.notifyState}});
i()
}function h(j,k){d();
b(k)
}return{init:function(j){e=j;
d();
c.subscribe("/dprforms/notifyCountry",h);
g()
}}
})(jQuery);