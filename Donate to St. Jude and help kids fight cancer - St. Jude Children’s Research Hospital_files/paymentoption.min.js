var stjude=stjude||{};
stjude.dprforms=stjude.dprforms||{};
stjude.dprforms.paymentoption=(function(g){var h={};
var B;
var u;
var z;
var a;
var t=false;
var n=false;
var l=false;
function v(D,E,C){g("#"+D).hide();
g("#paymentAlert").html(C);
g("#paymentAlert").show();
g("#"+E).click();
setTimeout(function(){g("#paymentAlert").fadeOut(2000)
},8000);
g.publish("/dprforms/formUpdate")
}function b(){var C=g("#accountTypePersonalRB").val();
if(C=="personal"){g("#corporateChecking").hide();
g("#personalChecking").show()
}else{g("#personalChecking").hide();
g("#corporateChecking").show()
}g.publish("/dprforms/formUpdate")
}function x(C){g("#cc-link").removeClass("visa mastercard discover americanexpress");
if(/^5[1-5]|^(?:222[1-9]|2[3-6]\d{2}|27[0-1]\d|2720)/.test(C)){g("#cc-link").addClass("mastercard")
}else{if(/^4/.test(C)){g("#cc-link").addClass("visa")
}else{if(/^3[47]/.test(C)){g("#cc-link").addClass("americanexpress")
}else{if(/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/.test(C)){g("#cc-link").addClass("discover")
}}}}}function j(){if(g("#pbc").is(":visible")){g("input[name=paymentMethod]").val("check")
}else{if(g("#pp")&&g("#pp").is(":visible")){g("input[name=paymentMethod]").val("paypal")
}else{if(g("#amz")&&g("#amz").is(":visible")){g("input[name=paymentMethod]").val("amazonpay")
}else{if(g("#ap")&&g("#ap").is(":visible")){g("input[name=paymentMethod]").val("applepay")
}else{if(g("#cc")&&g("#cc").is(":visible")){g("input[name=paymentMethod]").val("credit card");
x(g("input[name=cardNumber]").val())
}}}}}g.publish("/dprforms/paymentMethodChange",g("input[name=paymentMethod]").val());
g.publish("/dprforms/formUpdate")
}function o(D,C){var E=g(".nachaDonationAmount");
if(C!=null&&C!=""){E.text(C);
B=C
}else{E.text("");
B=""
}}function w(F,E,G){var D=g(".nachaFirstName");
var C=g(".nachaLastName");
if(E||G){D.text(E+" ");
C.text(G);
u=E+" ";
z=G
}else{D.text("");
C.text("");
u="";
z=""
}}function k(C,D){if(D=="CA"){g("#pbc-link").parent().removeClass("countryDisabled");
if(g("#ap-link").hasClass("active")){v("ap","cc-link","")
}g("#ap-link").parent().addClass("countryDisabled")
}else{if(D=="US"){g("#pbc-link").parent().removeClass("countryDisabled");
g("#ap-link").parent().removeClass("countryDisabled")
}else{if(g("#pbc-link").hasClass("active")){v("pbc","cc-link",h.checkPaymentAlert)
}if(g("#ap-link").hasClass("active")){v("ap","cc-link","")
}g("#pbc-link").parent().addClass("countryDisabled");
g("#ap-link").parent().addClass("countryDisabled")
}}}function m(D,C){if(C=="monthly"){if(g("#amz-link").hasClass("active")){v("amz","cc-link","")
}g("#standardCheckStatement").hide();
g("#eCheckMonthlyBlurb").show();
g("#eftAgreement").show();
g("#amz-link").parent().addClass("frequencyDisabled");
if(a&&l){g("#ap-link").parent().addClass("frequencyDisabled");
if(g("#ap-link").hasClass("active")){v("ap","cc-link","")
}}if(n){g("#pp-link").parent().addClass("frequencyDisabled");
if(g("#pp-link").hasClass("active")){v("pp","cc-link","")
}}}else{if(C=="one time"){g("#standardCheckStatement").show();
g("#eftAgreement").hide();
g("#pp-link").parent().removeClass("frequencyDisabled");
g("#ap-link").parent().removeClass("frequencyDisabled");
g("#amz-link").parent().removeClass("frequencyDisabled")
}}if(!(g("#paymentType ul li a").hasClass("active"))){v("","cc-link","")
}}function s(D,C){var E=g("input[name=frequency]").val();
if(C){g("#ap-link").parent().show();
l=true;
if(E=="monthly"){if(a){g("#ap-link").parent().addClass("frequencyDisabled");
if(g("#ap-link").hasClass("active")){v("ap","cc-link","")
}}}else{g("#ap-link").parent().show()
}}else{g("#ap-link").parent().remove();
g("#ap").remove()
}}function r(C){if(C.match(/^(?:5[1-5])\d{14}$|^(?:222[1-9]|2[3-6]\d{2}|27[0-1]\d|2720)\d{12}$/)){creditCardType="credit card-master card";
return"1_5_Credit Card - CyberSource_Master Card"
}else{if(C.match(/^4\d{12}(?:\d{3})?$/)){creditCardType="credit card-visa";
return"1_5_Credit Card - CyberSource_Visa"
}else{if(C.match(/^3[47]\d{13}$/)){creditCardType="credit card-american express";
return"1_5_Credit Card - CyberSource_American Express"
}else{if(C.match(/^6(?:011\d{12}|5\d{14}|4[4-9]\d{13}|22(?:1(?:2[6-9]|[3-9]\d)|[2-8]\d{2}|9(?:[01]\d|2[0-5]))\d{10})$/)){creditCardType="credit card-discover";
return"1_5_Credit Card - CyberSource_Discover"
}}}}creditCardType="credit card-unknown";
return"UNKNOWN"
}function d(){var F=g("#expMonth").val();
var E=g("#expYear").val();
var D=new Date(E,F,1);
var C=new Date();
return D>C
}function q(){g(".nachaBankAccountType").text(g('#bankAccountType option:selected"').text().toLowerCase())
}function e(){jQuery.validator.addMethod("creditCardType",function(D,C){return(r(D)!="UNKNOWN")
},h.cardType);
jQuery.validator.addMethod("creditCardDate",function(D,C){return(d())
},h.cardDate);
g("#cardNumber").rules("add",{required:true,creditcard:true,creditCardType:true,messages:{required:h.cardNumber,creditcard:h.cardNumber,pattern:h.cardNumber}});
g("#cardCvv2").rules("add",{required:true,digits:true,minlength:3,maxlength:4,messages:{required:h.cardCvv2,digits:h.cardCvv2,minlength:h.cardCvv2,maxlength:h.cardCvv2,pattern:h.cardCvv2}});
g("#expMonth").rules("add",{creditCardDate:true,messages:{required:h.cardDate,accept:h.cardDate}});
g("#accountNumber").rules("add",{required:true,digits:true,minlength:3,maxlength:16,messages:{required:h.accountNumber,digits:h.accountNumber,minlength:h.accountNumber,maxlength:h.accountNumber,pattern:h.accountNumber}});
g("#routingNumber").rules("add",{required:true,accept:/^((0[0-9])|(1[0-2])|(2[1-9])|(3[0-2])|(6[1-9])|(7[0-2])|80)([0-9]{7})$/,maxlength:9,messages:{required:h.routingNumber,accept:h.routingNumber,maxlength:h.routingNumber,pattern:h.routingNumber}});
g("#driversLicense").rules("add",{required:true,accept:/^[0-9A-Za-z- ]+$/,messages:{required:h.driversLicense,accept:h.driversLicense}});
g("#driversLicenseState").rules("add",{forbidden:/\s/,messages:{forbidden:h.driversLicenseState}});
g("#companyName").rules("add",{required:true,noEmoji:true,messages:{required:h.companyName}});
g("#companyTaxId").rules("add",{required:true,accept:/^[0-9]+$/,messages:{required:h.companyTaxId,accept:h.companyTaxId}});
g("#expYear").on("change",function(){g("#expMonth").trigger("click")
});
g("#expMonth").on("change",function(C){g(this).valid()
})
}function i(D){var C={};
C.firstName='<span class="nachaFirstName"></span>';
C.lastName='<span class="nachaLastName"></span>';
C.checkBankAccountType='<span class="nachaBankAccountType">'+g('#bankAccountType option:selected"').text()+"</span>";
C.frequency=D;
C.total='<span class="nachaDonationAmount"></span>';
return C
}function f(){var F;
var E={scope:"profile payments:widget payments:billing_address payments:shipping_address",popup:true};
F=amazon.Login.authorize(E,function(G){C();
D();
if(G.error){return
}y();
g("input[name=amazonAccessToken]").val(G.access_token);
g("#walletWidgetDiv").show();
g("#logout").show()
});
var C=function(){var G=null;
new OffAmazonPayments.Widgets.Wallet({sellerId:"AA2V7Q3F1MVIE",onOrderReferenceCreate:function(H){G=H.getAmazonOrderReferenceId();
g("input[name=amazonOrderReferenceId]").val(G)
},design:{designMode:"responsive"}}).bind("walletWidgetDiv")
};
var D=function(){t=true
}
}function A(D){var C=g("#amazonOrderReferenceId").val();
new OffAmazonPayments.Widgets.Wallet({sellerId:"AA2V7Q3F1MVIE",amazonOrderReferenceId:C,design:{designMode:"responsive"}}).bind("walletWidgetDiv")
}function c(C){amazon.Login.logout();
g("#walletWidgetDiv").hide();
g("#logout").hide();
g("#cc-link").click()
}function y(){if(t===true){g("#paymentType ul li a").removeClass("active");
g("#amz-link").addClass("active");
g("#paymentType div.tabContents").hide();
g("#amz").show();
g("#amz input:enabled:visible:first").focus();
j()
}}function p(){g("#OffAmazonPaymentsBridgeIframe").attr("title",h.amazonIframeTitle)
}return{init:function(C){h=C;
e();
g.subscribe("/dprforms/eventsReady",function(){var D=stjude.dprforms.dprutils.getParameterByName("default_payment");
if(D&&!(g("#"+D+"-link").parent().hasClass("frequencyDisabled"))){v("",D+"-link","")
}j();
stjude.dprforms.nacha.getAchLanguage(stjude.dprforms.nachaRecurringUrl,"#eftAgreement > p",i("monthly"),function(){g("#eftAgreement .nachaDonationAmount").text(B);
g("#eftAgreement .nachaFirstName").text(u);
g("#eftAgreement .nachaLastName").text(z)
});
stjude.dprforms.nacha.getAchLanguage(stjude.dprforms.nachaOttUrl,"#standardCheckStatement > p",i("one time"),function(){g("#standardCheckStatement .nachaDonationAmount").text(B);
g("#standardCheckStatement .nachaFirstName").text(u);
g("#standardCheckStatement .nachaLastName").text(z)
})
});
g.subscribe("/dprforms/amount",o);
g.subscribe("/dprforms/nameChange",w);
g.subscribe("/dprforms/country",k);
g.subscribe("/dprforms/frequency",m);
g.subscribe("/dprforms/amazonInvalidPaymentMethod",A);
g.subscribe("/dprforms/handleAmazonAccountIssue",c);
if(h.enableApplepay){g.subscribe("/dprforms/applepay",s)
}if(h.disableMonthlyApplePayOption){a=true
}if(h.disableMonthlyPayPalOption){n=true
}g("#cardNumber").keyup(function(){x(this.value)
});
g("#cardNumber, #cardCvv2, #routingNumber, #accountNumber, #intlPhoneNumber, #companyTaxId").keypress(function(D){if(g.inArray(D.keyCode,[46,8,9,27,13])!==-1||(D.charCode==97&&(D.ctrlKey===true||D.metaKey===true))||(D.charCode==99&&(D.ctrlKey===true||D.metaKey===true))||(D.charCode==118&&(D.ctrlKey===true||D.metaKey===true))||(D.charCode==120&&(D.ctrlKey===true||D.metaKey===true))||(D.keyCode>=35&&D.keyCode<=40)){return
}else{if(D.charCode<48||D.charCode>57){D.preventDefault()
}}});
g("#cardNumber, #cardCvv2, #routingNumber, #accountNumber, #intlPhoneNumber, #companyTaxId").on("paste",function(){var D=this;
setTimeout(function(){g(D).val(g(D).val().replace(/\D/g,""))
},0)
});
g("#cardNumber").change(function(){x(this.value)
});
g("#paymentType ul li a").click(function(E){E.preventDefault();
var D=g(this).attr("href");
if((g(D).css("display")=="none")&&D!="#amz"){g("#paymentType ul li a").removeClass("active");
g(this).addClass("active");
g("#paymentType div.tabContents").hide();
g(D).show();
paymentType=D;
g(D+" input:enabled:visible:first").focus();
j()
}});
g("#bankAccountType").change(function(){q()
});
j();
b();
x(g("input[name=cardNumber]").val());
g("#accountTypePersonalRB").change(function(){b()
});
g("#amz-link").click(function(){f()
});
g("#logout").click(function(){c();
g("#billingPageWrapper .paymentAlert").hide()
});
p()
}}
})(jQuery);