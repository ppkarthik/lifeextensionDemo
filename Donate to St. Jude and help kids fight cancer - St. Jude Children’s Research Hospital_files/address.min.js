var stjude=stjude||{};
stjude.dprforms=stjude.dprforms||{};
stjude.dprforms.address=(function(f){var d=[],k=[],q={},m="/services/dp/stateprovince.",b=".json",g;
function p(){var t=0;
var s=0;
f("#stateProvince > option").each(function(){var w=f(this).val();
var x=f(this).text();
var u=f(this).attr("class");
var v=f(this).attr("selected");
if(u=="US"){d[t]=[w,x,v];
q[w]="US";
t++
}if(u=="CA"){k[s]=[w,x,v];
q[w]="CA";
s++
}})
}function o(v,s){var u=f("#intlStateProvince");
u.empty();
u.append(f("<option>",{value:"",text:"---"}));
for(var t=1;
t<s.length;
t++){u.append(f("<option>",{value:s[t].value,text:s[t].text}))
}}function h(){var s=stjude.dprforms.dprutils.getParameterByName("stateProvince");
if(s){if(f("#stateProvince").find('option[value="'+s.toUpperCase()+'"]').length>0){f("#stateProvince").val(s.toUpperCase())
}}}function e(t){var s=m+t+b;
jQuery.ajax({type:"GET",url:s,dataType:"json",timeout:"2000",success:function(u){o(t,u)
},error:function(w,v,u){o(t,[{status:"error"}])
}})
}function a(v){var y=v;
if(y=="US"){var u=f(".zipWrapper").data("zipcodelabel");
var x=f("#stateOrProvinceLabel").data("statelabel");
f(".international").hide();
f(".domestic").show();
opttext="";
for(var t in d){if(d[t][2]){opttext+="<option value='"+d[t][0]+"' selected disabled>"+d[t][1]+"</option>"
}else{if(!f.trim(d[t][0])&&d[t][1]){opttext+="<option value=' ' disabled>"+d[t][1]+"</option>"
}else{if(d[t][0]&&d[t][1]){opttext+="<option value="+d[t][0]+">"+d[t][1]+"</option>"
}}}}f("#stateProvince").html(opttext);
f("#stateOrProvinceLabel").html('<span class="requiredMark">* </span>'+x);
f("#zipPostalCodeLabel").html('<span class="requiredMark">* </span>'+u);
f("#zipPostalCode").attr("pattern","[0-9]*");
f("#zipPostalCode").attr("maxlength","5");
if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1){f("#zipPostalCode").clone().attr("type","text").insertAfter("#zipPostalCode").prev().remove()
}else{f("#zipPostalCode").clone().attr("type","number").insertAfter("#zipPostalCode").prev().remove()
}f("#zipPostalCode").on("keyup keypress blur change",function(A){if(f(this).val().length>0){if(f(this).val().length>=parseInt(f(this).attr("maxlength"))&&(A.which!=8&&A.which!=0)){return false
}}});
if(typeof f("#zipPostalCode").unmask()!=="undefined"){f("#zipPostalCode").unmask()
}n(y);
r(y);
stjude.dprforms.zipcodeAutofill.init()
}else{if(y==="CA"){f(".international").hide();
f(".domestic").show();
var z=f(".zipWrapper").data("postcodelabel");
var w=f("#stateOrProvinceLabel").data("provincelabel");
opttext="";
opttext+='<option value="" >---</option>';
for(var s in k){if(k[s][0]&&k[s][1]){opttext+="<option value="+k[s][0]+">"+k[s][1]+"</option>"
}}f("#stateProvince").html(opttext);
f("#stateOrProvinceLabel").html('<span class="requiredMark">* </span>'+w);
f("#zipPostalCodeLabel").html('<span class="requiredMark">* </span>'+z);
f("#zipPostalCode").attr("pattern","");
f("#zipPostalCode").attr("maxlength","8");
f("#zipPostalCode").clone().attr("type","text").insertAfter("#zipPostalCode").prev().remove();
if(typeof f("#zipPostalCode").unmask()!=="undefined"){f("#zipPostalCode").unmask()
}stjude.dprforms.mask.maskZip(y,f("#zipPostalCode"));
n(y);
r(y)
}else{f(".domestic").hide();
f(".international").show()
}}f.publish("/dprforms/formUpdate")
}function r(s){if(s==="US"||s==="CA"){f("#stateProvince-error").html(g.country_ErrorMessage[s].stateProvince);
f("#stateProvince").rules("remove","required");
f("#stateProvince").rules("add",{required:true,messages:{required:g.country_ErrorMessage[s].stateProvince}})
}}function n(s){if(s==="US"||s==="CA"){f("#zipPostalCode-error").html(g.country_ErrorMessage[s].zipPostalCode);
f("#zipPostalCode").rules("remove","required");
f("#zipPostalCode").rules("add",{required:true,zipCode:true,minlength:5,messages:{required:g.country_ErrorMessage[s].zipPostalCode,zipCode:g.country_ErrorMessage[s].zipPostalCode,minlength:g.country_ErrorMessage[s].zipPostalCode,pattern:g.country_ErrorMessage[s].zipPostalCode}})
}}function c(){jQuery.validator.addMethod("zipCode",function(u,s){var t;
if(jQuery("#country").val()==="CA"){t=/^[a-zA-Z]\d[a-zA-Z] \d[a-zA-Z]\d$/
}else{t=/^[0-9]{5}$/
}return this.optional(s)||t.test(u)
},"zip code is not formatted correctly.");
f("#address1").rules("add",{required:true,hasLetters:true,cybersource:true,noEmoji:true,messages:{required:g.address1,hasLetters:g.address1}});
f("#address2").rules("add",{required:false,cybersource:true,noEmoji:true});
f("#intladdress3").rules("add",{required:false,cybersource:true,noEmoji:true});
f("#city").rules("add",{required:true,hasLetters:true,cybersource:true,noEmoji:true,messages:{required:g.city,hasLetters:g.city}});
r("US");
n("US");
f("#intladdress1").rules("add",{required:true,cybersource:true,noEmoji:true,messages:{required:g.intladdress1}});
f("#intladdress2").rules("add",{cybersource:true,noEmoji:true});
f("#intlCity").rules("add",{required:true,hasLetters:true,cybersource:true,noEmoji:true,messages:{required:g.intlCity}});
f("#intlStateProvince").rules("add",{required:true,cybersource:true,noEmoji:true,messages:{required:g.intlStateProvince}});
f("#intlZipPostalCode").rules("add",{required:true,cybersource:true,noEmoji:true,messages:{required:g.intlZipPostalCode}})
}function l(s){if(s==="US"&&/(^\d{5}$)/.test(stjude.dprforms.dprutils.getParameterByName("zipPostalCode"))){f("#zipPostalCode").val(stjude.dprforms.dprutils.getParameterByName("zipPostalCode"))
}else{if(s==="CA"&&/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/.test(stjude.dprforms.dprutils.getParameterByName("zipPostalCode"))){f("#zipPostalCode").val(stjude.dprforms.dprutils.getParameterByName("zipPostalCode"))
}else{f("#zipPostalCode").val("")
}}}function i(s,t){a(t);
l(t);
if(t.toUpperCase()=="US"||t.toUpperCase()=="CA"){h()
}else{e(t)
}}function j(){var s=f("#stateProvince").val();
var t=q[s];
if(typeof(s)!==undefined||typeof(t)!==undefined||t!==null){f.publish("/dprforms/stateProvinceCountry",t)
}}return{init:function(s){g=s;
c();
stjude.dprforms.zipcodeAutofill.init();
p();
h();
f("#stateProvince").change(function(t){j()
});
f.subscribe("/dprforms/country",i);
f.subscribe("/dprforms/eventsReady",function(){stjude.dprforms.dprutils.setObjectValuesFromURLParams({"#address1":"address1","#address2":"address2","#city":"city","#intladdress1":"address1","#intladdress2":"address2","#intladdress3":"address3","#intlCity":"city","#intlStateProvince":"stateProvince","#intlZipPostalCode":"zipPostalCode"})
})
}}
})(jQuery);
var stjude=stjude||{};
stjude.dprforms=stjude.dprforms||{};
stjude.dprforms.zipcodeAutofill=(function(b){function d(e,f,g){b.ajax({type:"GET",url:e,data:{zipcode:f},dataType:"json",contentType:"application/json; charset=utf-8",crossDomain:true,cache:false,success:g})
}var c=function(e,g,f){if(f.status==200&&e!=null&&e.status){b("#city").val(e.city);
b("#stateProvince").val(e.state)
}else{b("#city").val("");
b("#stateProvince").val("")
}};
function a(f){if(b.inArray(f.keyCode,[46,8,9,27,13,110,190])!==-1||(f.keyCode===65&&(f.ctrlKey===true||f.metaKey===true))||(f.keyCode>=35&&f.keyCode<=40)){return
}if((f.shiftKey||(f.keyCode<48||f.keyCode>57))&&(f.keyCode<96||f.keyCode>105)){f.preventDefault()
}}return{init:function(){var e=stjude.dprforms.zipcodeAutofillUrl;
b("#zipPostalCode").keydown(function(f){if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1){var g=b("#country").val();
if(g=="US"&&typeof e!="undefined"){a(f)
}}});
b("#zipPostalCode").keyup(function(g){var h=b("#country").val();
if(h=="US"&&typeof e!="undefined"){var f=b("#zipPostalCode").val();
f=f.replace("_","");
if(f.length>=5){d(e,f,c)
}}})
}}
})(jQuery);