var stjude=stjude||{};
stjude.dprforms=stjude.dprforms||{};
stjude.dprforms.odf=(function(f){var b;
var i;
var h;
var g;
var m;
function z(){f("#mainAlert").hide();
f("#paymentAlert").hide();
return true
}function t(B){var C=B.substr(B.lastIndexOf(".html"));
return B.replace(C,"")
}function s(B){var C={};
if(B.country==="US"||B.country==="CA"){C.address1=B.address1;
if(B.address2){C.address2=B.address2
}C.city=B.city;
C.stateProvince=B.stateProvince;
C.zipPostalCode=B.zipPostalCode;
C.phoneNumber=stjude.dprforms.dprutils.stripNonNumbers(B.phoneNumber)
}else{C.address1=B.intladdress1;
if(B.intladdress2){C.address2=B.intladdress2
}if(B.intladdress3){C.address3=B.intladdress3
}C.city=B.intlCity;
C.stateProvince=B.intlStateProvince;
C.zipPostalCode=B.intlZipPostalCode;
C.phoneNumber=B.intlPhoneNumber
}C.country=B.country;
C.firstName=B.firstName;
C.lastName=B.lastName;
C.email=B.email;
C.stayConnected=B.stayConnected;
C.consentId=stjude.dprforms.emailoptincheckbox.getConsentId(f("#country").val());
return C
}function w(C){var B={};
B.stayConnected=C.stayConnected;
B.consentId=stjude.dprforms.emailoptincheckbox.getConsentId(f("#country").val());
return B
}function q(B){var C={};
C.stayConnected=B.stayConnected;
C.consentId=stjude.dprforms.emailoptincheckbox.getConsentId(f("#country").val());
return C
}function y(B,C){var D={};
D.fingerPrintId=B.fingerPrintId;
D.paymentMethod=B.paymentMethod;
if(B.paymentMethod==="credit card"){D.cardNumber=B.cardNumber;
D.cardCvv2=B.cardCvv2;
D.expMonth=B.expMonth;
D.expYear=B.expYear
}else{if(B.paymentMethod==="check"){if(B.accountType==="personal"){D.accountType=B.accountType;
D.bankAccountType=B.bankAccountType;
D.routingNumber=B.routingNumber;
D.accountNumber=B.accountNumber;
D.driversLicense=B.driversLicense;
D.driversLicenseState=B.driversLicenseState
}else{if(B.accountType==="business"){D.accountType=B.accountType;
D.bankAccountType=B.bankAccountType;
D.routingNumber=B.routingNumber;
D.accountNumber=B.accountNumber;
D.companyName=B.companyName;
D.companyTaxId=B.companyTaxId
}}if(B.frequency==="one time"){D.eftDocumentID=B.eftDocumentID_oneTime
}else{D.eftDocumentID=B.eftDocumentID_monthly
}D.eftRevision=B.eftRevision
}else{if(B.paymentMethod==="paypal"){D.returnUrl=t(window.location.href)+"/confirmation.html";
D.cancelUrl=window.location.href.split("?")[0]+"?cancelPayment=true"
}else{if(B.paymentMethod==="applepay"){D.applePayData=C
}else{if(B.paymentMethod==="amazonpay"){D.amazonAccessToken=B.amazonAccessToken;
D.amazonOrderReferenceId=B.amazonOrderReferenceId
}}}}}return D
}function o(E){var C={};
C.type=E.lineItemType;
C.productName=E.productName;
C.productId=E.productId;
C.productCode=E.productCode;
C.sourceCode=E.sourceCode;
C.amount=e();
C.frequency=E.frequency;
if(E.lineItemType==="tribute"){C.tributeeFirstName=E.tributeeFirstName;
C.tributeeLastName=E.tributeeLastName;
if(E.dedicationType==="memorial"){C.tributeType="memorial"
}else{C.tributeType="honor"
}C.tributeDeliveryType=E.deliveryType;
C.rootProductCode=E.productCode;
if(f('input:radio[name="cardChoice"]:checked').data("bulkflag")&&(f('input[name="mailoption"]:checked').attr("id")=="sendToDonor")){C.productCode=f('input:radio[name="cardChoice"]:checked').data("bulkproductcode")
}else{C.productCode=f('input:radio[name="cardChoice"]:checked').data("productcode")
}if(h.retroTributesSourceSwitch=="true"&&E.inputAutoCompleteOrgName==undefined){C.sourceCode=f('input:radio[name="cardChoice"]:checked').data("sourcecode")
}if(E.hasOwnProperty("quantity")){if(E.quantity!==""){C.quantity=E.quantity
}}if(E.deliveryType==="ecard"){C.senderName=E.senderName;
C.personalizedMessage=E.personalizedMessageEmail;
C.recipientEmails=[];
var G={};
G.firstName=E.notifyFirstName;
G.lastName=E.notifyLastName;
G.email=E.emailRec;
C.eCardLocation=f('input:radio[name="cardChoice"]:checked').data("html5file");
C.recipientEmails.push(G)
}else{if(E.deliveryType==="mail-card"){C.senderName=E.senderName;
C.personalizedMessage=E.personalizedMessageMail;
C.personalizedMessageLine2=E.personalizedMessageMail2;
if(f('input:radio[name="cardChoice"]:checked').data("bulkflag")&&(f('input[name="mailoption"]:checked').attr("id")=="sendToDonor")){C.standardBulkFlag=true;
C.tributeDeliveryType="mail-card-bulk"
}else{C.standardBulkFlag=false;
C.recipientAddresses=[];
var B={};
B.firstName=E.notifyFirstName;
B.lastName=E.notifyLastName;
if(f("#addressValidStatusRec").val()==="MINOR_CHANGES"||f("#addressValidStatusRec").val()==="SUGGESTION_ACCEPTED"){B.address1=f("#notifyAddress1").data("corrected");
if(f("#notifyAddress2").data("corrected")){B.address2=f("#notifyAddress2").data("corrected")
}B.city=f("#notifyCity").data("corrected");
B.stateProvince=f("#notifyState").data("corrected");
B.zipPostalCode=f("#notifyZipPostalCode").data("corrected")
}else{B.address1=E.notifyAddress1;
if(E.notifyAddress2){B.address2=E.notifyAddress2
}B.city=E.notifyCity;
B.stateProvince=E.notifyState;
B.zipPostalCode=E.notifyZipPostalCode
}B.country=E.notifyCountry;
B.addressValidationStatus=E.addressValidStatusRec;
C.recipientAddresses.push(B)
}}}}if(E.country==="US"&&stjude.dprforms.incentive){var F={};
F.productId=stjude.dprforms.incentive.getProductId();
F.productName=stjude.dprforms.incentive.getProductName();
F.type="incentive";
F.qualifications=stjude.dprforms.incentive.getQualifications();
F.qualified=stjude.dprforms.incentive.isQualified();
F.fairMarketValue=stjude.dprforms.incentive.getFairMarketValue();
if(typeof stjude.dprforms.incentive.getFairMarketValueDetails()!=="undefined"){F.fairMarketValueVariables=stjude.dprforms.incentive.getFairMarketValueDetails()
}F.benefitId=stjude.dprforms.incentive.getBenefitId();
if(E.hasOwnProperty("incentiveVariation")){F.variation=E.incentiveVariation
}F.incentiveColor=stjude.dprforms.incentive.getIncentiveColor();
F.incentiveDescriptiveId=stjude.dprforms.incentive.getIncentiveDescriptiveId();
C.addon=F;
F.incentiveOptOut=E.incentiveOptOutCheckbox?true:false;
if(!E.incentiveOptOutCheckbox){F.incentiveDescriptor=E.incentiveDescriptor;
F.incentiveFirstName=E.incentiveFirstName;
F.incentiveLastName=E.incentiveLastName
}}var D=u(E);
if(Object.keys(D).length>0){var H=JSON.stringify(D);
C.attributes=r(H)
}return C
}function r(B){return btoa(encodeURIComponent(B).replace(/%([0-9A-F]{2})/g,function(C,D){return String.fromCharCode(parseInt(D,16))
}))
}function u(D){var B={};
var F="attr-";
for(var C in D){if(C.indexOf(F)===0){var E=C.slice(C.indexOf(F)+F.length);
if(D[C].length>0){B[E]=D[C]
}}}return B
}function A(B,D){var C={};
C.lineItems=[];
C.language=stjude.dprforms.pageLanguage;
C.clientId="donation";
C.pathId=B.donationPathId;
C.partnerInfo=B.partnerInformation;
C.userAgent=navigator.userAgent.substring(0,256);
C.payment=y(B,D);
if(C.payment.paymentMethod==="paypal"){C.billingInfoPayPal=w(B)
}else{if(C.payment.paymentMethod==="applepay"){C.billingInfoFrictionlessPayment=q(B)
}else{if(C.payment.paymentMethod==="amazonpay"){C.billingInfoFrictionlessPayment=q(B)
}else{C.billingInfo=s(B)
}}}C.lineItems.push(o(B));
return C
}function n(){f("#personalization-components-wrapper").show();
f.publish("/dprforms/formUpdate")
}function v(){if(stjude.dprforms.authorMode=="false"){f(".cnt_cardselection").nextUntil("section:last").wrapAll('<div id="personalization-components-wrapper"></div>');
f("#personalization-components-wrapper").hide()
}}function l(){stjude.payment.applepay.supported(function(B){if(B){f.publish("/dprforms/applepay",true)
}},function(){f.publish("/dprforms/applepay",false)
})
}function e(){var B=stjude.dprforms.donationamount.getDonationAmount();
return stjude.dprforms.dprutils.stripComma(B)
}function c(){v();
f.subscribe("/dprforms/deliveryMethodChange",n);
l()
}function p(){stjude.payment.applepay.beginSession({amount:parseFloat(e()),frequency:f("input[name=frequency]").val()},function(B){k(B)
},function(B){var C=h.applepayGenericMsg;
if(B.type&&B.type=="invalidFields"&&B.moreInfo!=null){B.moreInfo=B.moreInfo||[];
if(B.moreInfo.length>0){C=B.moreInfo.reduce(function(E,D,F){if(B.moreInfo.length-1==F){E=E.replace("list","<li>"+D+"</li>")
}else{E=E.replace("list","<li>"+D+"</li>list")
}return E
},h.applepayFieldValidationMsg+"<ul>list</ul>")
}}f(".mainAlert").html(C).show();
f("html, body").animate({scrollTop:0},"slow");
f("input:submit").prop("disabled",false)
},function(){f("input:submit").prop("disabled",false)
})
}function k(D){a();
f(".alert").hide();
var C=f("#donationForm").serializeObject();
var F=A(C,D);
var B=stjude.dprforms.libs.getTrueClientIpCookieValue();
var E={};
if(B!==undefined){E={"True-Client-IP":B}
}f.ajax({type:"POST",url:i,headers:E,data:JSON.stringify(F),xhrFields:{withCredentials:true},crossDomain:true,contentType:"application/json",timeout:40000,success:function(I,G,H){if(F.payment.paymentMethod==="paypal"){window.location.replace(stjude.dprforms.dprutils.decodeHtmlEntities(I._links.PayPal.href))
}else{if(f("input[name=paymentMethod]").val()==="applepay"){stjude.payment.applepay.end(ApplePaySession.STATUS_SUCCESS)
}window.location.replace(t(window.location.pathname)+"/confirmation.html?orderId="+I.orderId)
}},error:function(P,I,K){if(f("input[name=paymentMethod]").val()==="applepay"){stjude.payment.applepay.end(ApplePaySession.STATUS_FAILURE)
}var L;
var N;
try{N=JSON.parse(P.responseText);
L=N.reason;
if(L==null||typeof L=="undefined"){L="error"
}}catch(J){L=I
}var M=f(".mainAlert");
var G=f("#billingPageWrapper .paymentAlert");
if(L.indexOf("CreditCard")==0||L.indexOf("Check")==0||L.indexOf("PayPal")==0||L.indexOf("ApplePay")==0||L.indexOf("Amazon")==0){x("payment",L)
}else{x("system",L)
}switch(L){case"CreditCardError":case"CheckError":case"CreditCardExpired":case"InternalServerError":case"CreditCardInvalidAccount":case"ApplePayError":case"PayPalError":case"AmazonPayError":stjude.dprforms.donatebutton.displayBillingOption();
G.text(m[L]);
G.show();
f("html, body").animate({scrollTop:G.offset().top},0);
break;
case"Amazon-InvalidPaymentMethod":stjude.dprforms.donatebutton.displayBillingOption();
G.text(m[L]);
G.show();
f("html, body").animate({scrollTop:G.offset().top},0);
f.publish("/dprforms/amazonInvalidPaymentMethod");
break;
case"Amazon-TransactionTimedOut":stjude.dprforms.donatebutton.displayBillingOption();
G.text(m[L]);
G.show();
f("html, body").animate({scrollTop:G.offset().top},0);
f.publish("/dprforms/handleAmazonAccountIssue");
break;
case"Amazon-AmazonRejected":stjude.dprforms.donatebutton.displayBillingOption();
G.text(m[L]);
G.show();
f("html, body").animate({scrollTop:G.offset().top},0);
f.publish("/dprforms/handleAmazonAccountIssue");
break;
case"Amazon-PaymentMethodNotAllowed":stjude.dprforms.donatebutton.displayBillingOption();
G.text(m[L]);
G.show();
f("html, body").animate({scrollTop:G.offset().top},0);
f.publish("/dprforms/handleAmazonAccountIssue");
break;
case"InvalidDataError":if("fieldErrors" in N&&N.fieldErrors.length>0){var O=[];
N.fieldErrors.forEach(function(S){var R=f("label[for='"+S.field+"']").text();
if(typeof R!=="undefined"){R=R.replace(/\*|:/g,"").trim();
O.push(R)
}});
var Q=f("#billingPageWrapper .billingInfoAlert");
Q.text(m.InvalidDataMain+O.join(", "));
stjude.dprforms.donatebutton.displayBillingOption();
Q.show();
f("html, body").animate({scrollTop:Q.offset().top},0)
}else{G.text(m.InvalidDataPayment);
stjude.dprforms.donatebutton.displayBillingOption();
G.show();
f("html, body").animate({scrollTop:G.offset().top},0)
}break;
case"ProhibitedKeyword":var H=stjude.dprforms.fieldlabelconverter.getLabelFromField(F,N.fieldErrors,m);
M.text(m.ProhibitedKeyword+H.join(", "));
M.show();
f("html, body").animate({scrollTop:0},0);
break;
case"CreditCardTestAccount":f("<span id='ccProcessingUp' style='color: white;'>.</span>").appendTo(document.body);
default:M.text(m[L]||m.error);
M.show();
f("html, body").animate({scrollTop:0},0)
}d();
f.publish("/dprforms/processing","false")
},complete:function(G,H){}})
}function j(B){return function(C,D){if(C.tagName==="TEXTAREA"||(C.tagName==="INPUT"&&C.type!=="password")){C.value=f.trim(C.value)
}return B.call(this,C,D)
}
}function a(){f("body").css("pointer-events","none");
f("#donationForm input:submit").prop("disabled",true)
}function d(){f("body").css("pointer-events","");
f("#donationForm input:submit").prop("disabled",false)
}function x(E,F){if(h.enableErrorFormAnalytics){try{var B=document.getElementsByTagName("body");
var G;
if(typeof Event==="function"){G=new Event("form_error")
}else{G=document.createEvent("Event");
G.initEvent("form_error",true,true)
}var C={eventInfo:{eventName:"error",eventAction:F,eventType:E,timeStamp:new Date()}};
if(stjude.digitalData.event==null){stjude.digitalData.event=[C]
}else{stjude.digitalData.event.push(C)
}B[0].dispatchEvent(G);
return"success"
}catch(D){return"error: "+D.message
}}else{return"disabled"
}}return{init:function(C,D){i=C;
h=D;
if(f.isEmptyObject(m)){m=stjude.dprforms.i18n.getErrorDictionary()
}f.subscribe("/dprforms/eventsReady",c);
f.fn.serializeObject=function(){var F={};
var E=this.serializeArray();
f(E).each(function(G,H){F[H.name]=H.value
});
return F
};
if(h.authormode==="false"){f(window).on("load resize",function(){if(window.innerWidth<=600){f("#bottom-nav-container").prependTo("#billingInfoFooter");
f("#bottom-nav-container").addClass("mobile")
}else{f("#bottom-nav-container").removeClass("mobile");
f("#bottom-nav-container").prependTo("#header")
}f("#bottom-nav-container").show()
})
}var B;
g=f("#donationForm").validate({submitHandler:function(G){try{z();
if(f("input[name=paymentMethod]").val()==="applepay"){if(f("#makeTribute").is(":checked")&&f("#mail-card").is(":checked")&&!(f('input:radio[name="cardChoice"]:checked').data("bulkflag"))){f("#addressValidStatusRec").val("UNVERIFIABLE")
}p()
}else{f.publish("/dprforms/processing","true");
if(f("#makeTribute").is(":checked")&&f("#mail-card").is(":checked")&&!(f('input:radio[name="cardChoice"]:checked').data("bulkflag")&&(f('input[name="mailoption"]:checked').attr("id")=="sendToDonor"))){stjude.dprforms.addressvalidation.triggerAddressValidation(k)
}else{k()
}}}catch(E){d();
var F=f(".mainAlert");
F.text(m.javascriptException);
F.show();
f("html, body").animate({scrollTop:0},0)
}},ignore:":hidden",errorElement:"p",errorPlacement:function(E,F){if(f(F).hasClass("errorAfterParent")){f(F).parent().after(E)
}else{if(f(F).hasClass("errorAfterParentParent")){f(F).parent().parent().after(E)
}else{F.after(E)
}}},showErrors:function(F,G){if(B){var E=new Array();
f.each(F,function(H,I){E.push(H)
});
x("validation",E.join(":"));
B=false
}this.defaultShowErrors()
},invalidHandler:function(F,E){B=true
},onfocusout:j(f.validator.defaults.onfocusout)})
},getValidator:function(){return g
}}
})(jQuery);
function openWindow(c,b,e,a){var f=(screen.width-e)/2;
var d=(screen.height-a)/2;
window.open(c,b,"height="+a+",width="+e+",scrollbars=no,status=no,toolbar=no,menubar=no,location=no,top="+d+",left="+f);
return
}var stjude=stjude||{};
stjude.dprforms=stjude.dprforms||{};
stjude.dprforms.donatebutton=(function(d){var j;
var e=false;
function c(){d("#billingPageWrapper").show();
d("#donateButton").show();
d.publish("/dprforms/formUpdate")
}function f(k){if(k){d("#donateButton").show()
}else{d("#donateButton").hide()
}}function h(l,k){f(k)
}function g(o,l){var k=d("#donateButton");
if(typeof l!="undefined"&&l){var m=k.data("donate-text")+" $"+l;
k.val(m)
}else{k.val(k.data("donate-text"))
}if(d("input[name=frequency]").val()==="monthly"){var n=k.val()+" "+k.data("monthly-text");
k.val(n)
}}function b(m,l){var k=d("#donateButton");
var n=d("#makeTribute").is(":checked");
if(l=="true"){k.hide();
k.prop("disabled",true);
d("#donateLoadingButton").show()
}else{d("#donateLoadingButton").hide();
if(!e){k.show();
k.prop("disabled",false)
}}}function i(p,o){var m=d("#donateButton");
var k=m.data("monthly-text");
var n=m.val().split(" ");
if(o==="monthly"){n.push(k);
m.val(n.join(" "))
}else{var l=n.filter(function(q){return q!==k
});
m.val(l.join(" "))
}}function a(l,k){if(k==="paypal"){d(".loading-button").hide();
d(".loading-paypal").show();
d("#donateButton").removeClass("applePayButton");
d(".enableAmazonPay").hide();
d("#walletWidgetDiv").hide()
}else{if(k==="applepay"){d(".loading-button").show();
d(".loading-paypal").hide();
d("#donateButton").addClass("applePayButton");
d(".enableAmazonPay").hide();
d("#walletWidgetDiv").hide()
}else{if(k==="amazonpay"){d(".loading-button").show();
d(".loading-paypal").hide();
d(".enableAmazonPay").show();
d("#donateButton").removeClass("applePayButton")
}else{d(".loading-button").show();
d(".loading-paypal").hide();
d("#donateButton").removeClass("applePayButton");
d(".enableAmazonPay").hide();
d("#walletWidgetDiv").hide()
}}}}return{init:function(){d.subscribe("/dprforms/amount",g);
d.subscribe("/dprforms/processing",b);
d.subscribe("/dprforms/frequency",i);
d.subscribe("/dprforms/paymentMethodChange",a);
d.subscribe("/dprforms/showDonateButton",h)
},displayBillingOption:function(){e=true;
c()
}}
})(jQuery);
var stjude=stjude||{};
stjude.dprforms=stjude.dprforms||{};
stjude.dprforms.fieldlabelconverter=(function(b){var a={"billingInfo.firstName":{field:"firstName",en:"Your first name",es:"Su nombre"},"billingInfo.lastName":{field:"lastName",en:"Your last name",es:"Su apellido"},"billingInfo.email":{field:"email",en:"Your email address",es:"Su correo electrónico"},"billingInfo.address1":{field:"address1",en:"Your address",es:"Su dirección"},"billingInfo.address2":{field:"address2",en:"Your address 2",es:"Su no. de apartamento u otro"},"billingInfo.address3":{field:"intladdress3",en:"Your address 3",es:"Su dirección 3"},"billingInfo.zipPostalCode":{field:"intlZipPostalCode",en:"Your postal code",es:"Su código postal"},"billingInfo.city":{field:"city",en:"Your city",es:"Su ciudad"},"billingInfoPayPal.email":{field:"email",en:"Your email address",es:"Su correo electrónico"},"payment.driversLicense":{field:"driversLicense",en:"Your license or state ID #",es:"Su No. de licencia o identificación estatal"},"payment.companyName":{field:"companyName",en:"Your company's name",es:"Su nombre de la compañía"},"lineItems[0].tributeeFirstName":{field:"tributeeFirstName",en:"Tributee first name",es:"Nombre del homenajeado"},"lineItems[0].tributeeLastName":{field:"tributeeLastName",en:"Tributee last name",es:"Apellido del homenajeado"},"lineItems[0].senderName":{field:"senderName",en:"Sender name",es:"Enviado por"},"lineItems[0].recipientAddresses[0].firstName":{field:"notifyFirstName",en:"Recipient first name",es:"Nombre del destinatario"},"lineItems[0].recipientAddresses[0].lastName":{field:"notifyLastName",en:"Recipient last name",es:"Apellido del destinatario"},"lineItems[0].recipientAddresses[0].address1":{field:"notifyAddress1",en:"Recipient address",es:"Dirección del destinatario"},"lineItems[0].recipientAddresses[0].address2":{field:"notifyAddress2",en:"Recipient address 2",es:"no. de apartamento u otro del destinatario"},"lineItems[0].recipientAddresses[0].city":{field:"notifyCity",en:"Recipient city",es:"Ciudad del destinatario"},"lineItems[0].recipientEmails[0].firstName":{field:"notifyFirstName",en:"Recipient first name",es:"Nombre del destinatario"},"lineItems[0].recipientEmails[0].lastName":{field:"notifyLastName",en:"Recipient last name",es:"Apellido del destinatario"},"lineItems[0].recipientEmails[0].email":{field:"emailRec",en:"Recipient email",es:"Correo electrónico del destinatario"}};
return{getLabelFromField:function(e,i,c){var d=[];
if(e.lineItems[0].tributeDeliveryType==="ecard"){a["lineItems[0].personalizedMessage"]={field:"signatureAndMessage",en:"Personal message",es:"Mensaje personal"}
}else{if(e.lineItems[0].tributeDeliveryType==="mail-card"){a["lineItems[0].personalizedMessage"]={field:"mailCardGreeting",en:"Personal message",es:"Mensaje personal"};
a["lineItems[0].personalizedMessageLine2"]={field:"mailCardGreeting2",en:"Personal message2",es:"Mensaje personal2"}
}}for(var f in i){var h=a[i[f].field];
var g;
if(typeof h!=="undefined"){if(e.language==="es"){g=h.es
}else{g=h.en
}}else{g=i[f].field;
g=g.substring(g.lastIndexOf(".")+1)
}d.push(g)
}return d
}}
})(jQuery);