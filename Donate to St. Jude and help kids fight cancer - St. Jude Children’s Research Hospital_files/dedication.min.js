var stjude=stjude||{};
stjude.dprforms=stjude.dprforms||{};
stjude.dprforms.dedication=(function(f,k,q){var u=f('select[name="dedicationType"]');
var t=f('input:radio[name="deliveryType"]');
var i;
var e=f("input[name=dedicationBulkCheck]").val();
function o(y){f('input:radio[name="deliveryType"]').attr("disabled","disabled");
f('input:radio[name="deliveryType"]').each(function(){f(this).attr("checked",false).parent().removeClass("selected").hide()
});
f("#dedication-delivery-method ."+y).show();
f("#dedication-delivery-method ."+y+" input:radio").removeAttr("disabled");
if(i.authormode==="false"){f("#card-personalization").hide()
}}function r(){if(f('input:radio[name="deliveryType"]:enabled').length==1){f('input:radio[name="deliveryType"]:enabled:first').trigger("click");
f("#dedication-delivery-method").hide()
}else{f("#dedication-delivery-method").fadeIn();
if(f("#dedication-information").is(":visible")&&i.authorMode==="false"){f.publish("/dprforms/showDonateButton",false)
}}}function x(){if(f('input:radio[name="deliveryType"]:enabled').length>1){var A=f('input:radio[name="deliveryType"]:enabled');
for(var y=0;
y<A.length;
y++){if(A[y].value===i.defaultDeliveryType){A[y].click();
break
}}var z=f('input[name="deliveryType"]:checked').val();
if(z==undefined||z==null){f('input:radio[name="deliveryType"]:enabled:first').trigger("click")
}}}function l(y){f(".dedication-detail").hide();
f(".dedication-detail."+y).show()
}function p(y,z){f("#cards .cardSelection").hide();
f("#cards .cardSelection input").attr("disabled","disabled");
if(f("#cards .cardSelection."+z+"."+y).length>1){f("#chooseCardText").show();
f("#cards .cardSelection."+z+"."+y).show()
}else{f("#chooseCardText").hide()
}f("#cards .cardSelection."+z+"."+y+" input").removeAttr("disabled");
f("#cards .cardSelection."+z+"."+y+":first input").attr("checked",true)
}function m(){var z=f('input[name="cardChoice"]:checked').attr("id");
var y=f('input[name="deliveryType"]:checked').val();
if(y=="mail-card"){s(z)
}else{if(y=="ecard"){g(z)
}else{if(y=="insert"){w(z)
}else{b(z)
}}}f.publish("/dprforms/deliveryType",y)
}function b(z){f("#cardPreview").hide();
var y="<p>"+f("#"+z).data("descriptivetext")+"</p>";
f("#noCardDescriptiveText").html(y)
}function g(D){var A=f("#"+D).data("html5file");
var y=f("#"+D).data("ismobile");
var z="";
var C="?name="+encodeURIComponent(i.ecardNamePlaceholder)+"&message="+encodeURIComponent(i.ecardMessagePlaceholder);
z=f("<iframe/>",{id:"cardIFrame",name:"cardIFrame",src:A+C,scrolling:"no",frameBorder:"0",load:function(){var E=f(this).contents();
f("#cardPreview").show();
var F=f("#tributeMailCardPreview").width();
E.find("#_preload_div_").css("width",F);
E.find("#_preload_div_").css("height","100%")
}});
f("#tributeMailCardPreview").html(z).append("</div>");
var B=f("#"+D).data("charlimit");
f("#ecardCharLimit").text(B);
f("#signatureAndMessage").attr("maxlength",B)
}function s(C){var B='<ul><li><a href="#tributeMailCard-frontOfCard" class="tabbable">'+i.frontLabel+'</a></li><li><a href="#tributeMailCard-insideOfCard" class="tabbable">'+i.insideLabel+'</a></li><li><a href="#tributeMailCard-backOfCard" class="tabbable">'+i.backLabel+'</a></li><li><a href="#tributeMailCard-envelope" class="tabbable">'+i.envLabel+"</a></li></ul>";
B+="<div id='tributeMailCard-frontOfCard' class='cardSection'>";
B+='<img src="'+f("#"+C).data("cardimage")+'" alt="'+f("#"+C).data("frontalttext")+'"/>';
B+="</div>";
B+="<div id='tributeMailCard-insideOfCard' class='cardSection' style='display:none;'>";
B+='<img src="'+f("#"+C).data("insideimage")+'" alt="'+f("#"+C).data("insidealttext")+'"/>';
B+="</div><div id='tributeMailCard-backOfCard' class='cardSection' style='display:none;'>";
B+='<img src="'+f("#"+C).data("backimage")+'" alt="'+f("#"+C).data("backalttext")+'"/>';
B+="</div><div id='tributeMailCard-envelope' class='cardSection' style='display:none;'>";
B+='<img src="'+f("#"+C).data("envelopeimage")+'" alt="'+f("#"+C).data("envalttext")+'"/>';
B+="</div>";
f("#tributeMailCardPreview").html(B);
f("#cardPreview ul li a").first().addClass("selected");
h();
f("#cardPreview").show();
var A=f("#"+C).data("charlimit");
f("#mailcardCharLimit").text(A);
f("#personalizedMessageMail").attr("maxlength",A);
var y=f("#"+C).data("bulkflag");
if(y&&e==="true"){var z=f("#"+C).data("mindonpercard");
f.publish("/dprforms/mindonationpercard",z)
}else{f("#dedication-signature").show();
f("#recipient-info").show();
f("#dedication-quantity").hide();
f("#dedication-billing-message").hide()
}}function w(z){var y='<ul><li><a href="#tributeInsert-frontOfCard" class="tabbable">'+i.insert.frontLabel+'</a></li><li><a href="#tributeInsert-backOfCard" class="tabbable">'+i.insert.backLabel+"</a></li></ul>";
y+="<div id='tributeInsert-frontOfCard' class='cardSection'>";
y+='<img src="'+f("#"+z).data("cardimage")+'" alt="'+f("#"+z).data("frontalttext")+'"/>';
y+="</div>";
y+="<div id='tributeInsert-backOfCard' class='cardSection' style='display:none;'>";
y+='<img src="'+f("#"+z).data("backimage")+'" alt="'+f("#"+z).data("backalttext")+'"/>';
y+="</div>";
f("#tributeMailCardPreview").html(y);
f("#cardPreview ul li a").first().addClass("selected");
h();
f("#cardPreview").show()
}function h(){f("#cardPreview ul li a").click(function(z){z.preventDefault();
var y=f(this).attr("href");
if(f(y).css("display")=="none"){f("#cardPreview ul li a").removeClass("selected");
f(this).addClass("selected");
f(".cardSection").hide();
f(y).show()
}})
}function j(){var y=stjude.dprforms.dprutils.getParameterByName("frequency_selected");
if(y=="2"){u.val("memory");
f('select[name="dedicationType"]').trigger("change")
}else{if(y=="3"){u.val("honor");
f('select[name="dedicationType"]').trigger("change")
}}}function c(){if(f("#card-personalization").is(":visible")||i.authorMode==="true"){f.publish("/dprforms/showDonateButton",true)
}else{f.publish("/dprforms/showDonateButton",false)
}f.publish("/dprforms/formUpdate")
}function v(y){if(y){f("#tributesPageWrapper").show()
}else{f("#tributesPageWrapper").hide()
}}function n(y,z){isTributeOn=z;
v(z);
x()
}function a(){f("#signatureAndMessage").rules("add",{accept:/^$|^[0-9a-zA-ZáéíóúñüÁÉÍÓÚÑÜ¡\- _.,!\"'/$]+$/,messages:{accept:i.acceptDedicationMessage}});
f("#mailCardGreeting").rules("add",{accept:/^$|^[0-9a-zA-ZáéíóúñüÁÉÍÓÚÑÜ¡\- _.,!\"'/$]+$/,maxlength:60,messages:{accept:i.acceptDedicationMessage,maxlength:i.maxLength}});
f("#mailCardGreeting2").rules("add",{accept:/^$|^[0-9a-zA-ZáéíóúñüÁÉÍÓÚÑÜ¡\- _.,!\"'/$]+$/,maxlength:60,messages:{accept:i.acceptDedicationMessage,maxlength:i.maxLength}})
}function d(){return f("input[name=dedicationBulkCheck]").val()
}return{init:function(y){i=y;
f('select[name="dedicationType"]').change(function(){o(this.value);
r();
x();
f.publish("/dprforms/formUpdate")
});
f('input:radio[name="deliveryType"]').change(function(){f('input:radio[name="deliveryType"]').each(function(){f(this).parent().removeClass("selected")
});
f('input:radio[name="deliveryType"]:checked').parent().addClass("selected");
f("#card-personalization").hide();
p(u.val(),this.value);
l(this.value);
f("input:radio[name=cardChoice]").trigger("change");
f("#card-personalization").fadeIn();
f.publish("/dprforms/showDonateButton",true);
f.publish("/dprforms/formUpdate")
});
if(f.browser.msie||parseInt(f.browser.version)==11){f("#cards label div img").on("click",function(){f("#"+f(this).closest("label").attr("for")).prop("checked",true).change()
})
}f('input:radio[name="cardChoice"]').change(function(){f('input:radio[name="cardChoice"]').each(function(){f(this).parent().removeClass("selected")
});
f('input:radio[name="cardChoice"]:checked').parent().addClass("selected");
m();
f.publish("/dprforms/formUpdate")
});
f("#signatureAndMessage").on("paste keydown keyup keypress touchend",function(A){var z=f("#signatureAndMessage").val();
z=z.replace(/[\n\r]/g,"");
z=z.replace(/[‘’‛`]/g,"'");
z=z.replace(/[“”]/g,'"');
f("#signatureAndMessage").val(z)
});
f("#mailCardGreeting").on("paste keydown keyup keypress touchend",function(A){var z=f("#mailCardGreeting").val();
z=z.replace(/[\n]/g,"");
z=z.replace(/[‘’‛`]/g,"'");
z=z.replace(/[“”]/g,'"');
f("#mailCardGreeting").val(z)
});
f("#mailCardGreeting2").on("paste keydown keyup keypress touchend",function(A){var z=f("#mailCardGreeting2").val();
z=z.replace(/[\n]/g,"");
z=z.replace(/[‘’‛`]/g,"'");
z=z.replace(/[“”]/g,'"');
f("#mailCardGreeting2").val(z)
});
f.subscribe("/dprforms/showDedications",c);
f.subscribe("/dprforms/tributeOption",n);
o(u.val());
j();
r();
a();
f.publish("/dprforms/formUpdate")
},getDedicationBulkcheck:function(){return d()
}}
})(jQuery);