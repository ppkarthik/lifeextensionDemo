var stjude=stjude||{};
stjude.payment=stjude.payment||{};
stjude.payment.applepay=function(){var n=false;
var a;
var g;
var w={en:{name:"First Name or Last Name",street:"Street Address",city:"City",state:"State",zip:"Zip Code",country:"Country",email:"Email",phone:"Phone number"},es:{name:"Primer nombre o Apellido",street:"Dirección",city:"Ciudad",state:"Estado",zip:"Código Postal",country:"País",email:"Email",phone:"Teléfono"}};
var c={al:"alabama",alabama:"al",ak:"alaska",alaska:"ak",az:"arizona",arizona:"az",ar:"arkansas",arkansas:"ar",ca:"california",california:"ca",co:"colorado",colorado:"co",ct:"connecticut",connecticut:"ct",de:"delaware",delaware:"de",dc:"district of columbia","district of columbia":"dc",fl:"florida",florida:"fl",ga:"georgia",georgia:"ga",hi:"hawaii",hawaii:"hi",id:"idaho",idaho:"id",il:"illinois",illinois:"il","in":"indiana",indiana:"in",ia:"iowa",iowa:"ia",ks:"kansas",kansas:"ks",ky:"kentucky",kentucky:"ky",la:"louisiana",louisiana:"la",me:"maine",maine:"me",md:"maryland",maryland:"md",ma:"massachusetts",massachusetts:"ma",mi:"michigan",michigan:"mi",mn:"minnesota",minnesota:"mn",ms:"mississippi",mississippi:"ms",mo:"missouri",missouri:"mo",mt:"montana",montana:"mt",ne:"nebraska",nebraska:"ne",nv:"nevada",nevada:"nv",nh:"new hampshire","new hampshire":"nh",nj:"new jersey","new jersey":"nj",nm:"new mexico","new mexico":"nm",ny:"new york","new york":"ny",nc:"north carolina","north carolina":"nc",nd:"north dakota","north dakota":"nd",oh:"ohio",ohio:"oh",ok:"oklahoma",oklahoma:"ok",or:"oregon",oregon:"or",pa:"pennsylvania",pennsylvania:"pa",ri:"rhode island","rhode island":"ri",sc:"south carolina","south carolina":"sc",sd:"south dakota","south dakota":"sd",tn:"tennessee",tennessee:"tn",tx:"texas",texas:"tx",ut:"utah",utah:"ut",vt:"vermont",vermont:"vt",va:"virginia",virginia:"va",wa:"washington",washington:"wa",wv:"west virginia","west virginia":"wv",wi:"wisconsin",wisconsin:"wi",wy:"wyoming",wyoming:"wy",as:"american samoa","american samoa":"as",aa:"armed forces americas","armed forces americas":"aa",ae:"armed forces eur.,mid.east,africa,canada","armed forces eur.,mid.east,africa,canada":"ae",ap:"armed forces pacific","armed forces pacific":"ap",fm:"federated states of micronesia","federated states of micronesia":"fm",gu:"guam",guam:"gu",mh:"marshall islands","marshall islands":"mh",mp:"north mariana islands","north mariana islands":"mp",pw:"palau island","palau island":"pw",pr:"puerto rico","puerto rico":"pr",vi:"virgin islands","virgin islands":"vi"};
var i=[];
var h=["en","es"];
var q=function(F,G,E,D){return new Promise(function(J,I){j("starting getApplePaySession");
var H={grove:G,b64url:btoa(E),displayName:D};
H="sessionData="+JSON.stringify(H);
j(H);
var K=new XMLHttpRequest();
K.open("POST",F);
K.onload=function(){if(this.status>=200&&this.status<300){j("getApplePaySession Response");
j(JSON.parse(K.response));
J(JSON.parse(K.response))
}else{I({status:this.status,statusText:K.statusText})
}};
K.onerror=function(){I({status:this.status,statusText:K.statusText})
};
K.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
K.send(H)
})
};
var y=function(E,H,I,D){if(navigator.language&&h.indexOf(navigator.language.substring(0,2))==-1){I="na"
}var G={frequency:{onetime:{en:"",es:"",na:""},monthly:{en:"monthly",es:"mensual",na:""}}};
var F={countryCode:"US",currencyCode:"USD",merchantCapabilities:["supports3DS"],requiredShippingContactFields:["email","phone"],requiredBillingContactFields:["postalAddress","email","name","phone"],supportedNetworks:["amex","masterCard","visa"],total:{label:[D,G.frequency[H.toLowerCase().replace(/ /g,"")][I]].filter(Boolean).join(" "),amount:E}};
return F
};
var b=function(E){if(E!=null&&typeof E!="undefined"){var G=E.emailAddress;
var F=E.phoneNumber;
var D=[G,F];
var H=[w[g.lang].email,w[g.lang].phone];
return z(D,H)
}return false
};
var p=function(K){if(K!=null&&typeof K!=="undefined"){var L=K.givenName;
var M=K.familyName;
var J=K.addressLines||[""];
var E=K.postalCode;
var D=K.administrativeArea;
var G=K.locality;
var F=K.country;
var I=[L,M,J,E,D,G,F];
var H=[w[g.lang].name,w[g.lang].name,w[g.lang].street,w[g.lang].zip,w[g.lang].state,w[g.lang].city,w[g.lang].country];
return z(I,H)
}return false
};
var z=function(D,F){var E=true;
D.reduce(function(G,J,I){if(A(J)){E=false;
G.push(F[I])
}else{var H=true;
if(F[I]==w[g.lang].name){H=m(D[I])
}if(F[I]==w[g.lang].street){H=t(D[I])
}if(F[I]==w[g.lang].zip){H=u(D[I])
}if(F[I]==w[g.lang].state){H=C(D[I])
}if(F[I]==w[g.lang].city){H=e(D[I])
}if(F[I]==w[g.lang].country){H=v(D[I])
}if(F[I]==w[g.lang].email){H=r(D[I])
}if(F[I]==w[g.lang].phone){H=k(D[I])
}if(!H){E=false;
G.push(F[I])
}}return G
},i);
return E
};
var r=function(F){var D=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
var E=D.test(F.trim());
return E
};
var k=function(E){E=B(E);
if(/^\+1/.test(E)){E=E.substring(2)
}else{if(/^1/.test(E)){E=E.substring(1)
}else{if(/^\+[0]|\+[2-9]/.test(E)){return false
}else{}}}var D=!/[a-z]/.test(E)&&E.replace(/\D/g,"").length==10;
return D
};
var m=function(E){E=B(E);
var D=isNaN(E)&&!o(E);
return D
};
var v=function(F){F=B(F);
var E=["us","usa","united states","united states of america"];
var D=E.indexOf(F)>-1;
return D
};
var C=function(E){E=B(E);
var D=typeof c[E]!="undefined";
return D
};
var e=function(E){E=B(E);
var D=isNaN(E)&&!o(E);
return D
};
var u=function(E){E=B(E);
var D=!/[a-z]/.test(E)&&(E.replace(/\D/g,"").length==9||E.replace(/\D/g,"").length==5);
return D
};
var t=function(F){var D=false;
var E=!F.some(function(H,G){if(G==0){D=A(H)
}return D||o(B(H))
});
return E
};
var A=function(D){return !D||!D.toString().trim()
};
var l=function(D){return !A(D)&&!isNaN(D)
};
var s=function(D){return !A(D)&&["monthly","one time"].indexOf(D.toLowerCase())>-1
};
var B=function(D){return D.toString().toLowerCase().replace(/,/g,"").trim()
};
var o=function(D){return(/[&<>"]/.test(D.toString().trim()))
};
var j=function(D){if(stjude.payment.applepay.debugMode&&window.console.log){console.log(D)
}};
var d=function(D){a=D
};
var x=function(){return a
};
var f=function(){a=undefined
};
return{init:function(D){if(arguments[0]==null||typeof arguments[0].lang==="undefined"||typeof arguments[0].merchantID=="undefined"||typeof arguments[0].sessionURL=="undefined"||typeof arguments[0].displayName=="undefined"||typeof arguments[0].grove=="undefined"){throw new Error("Please pass the options with parameters lang, merchantID, sessionURL, displayName and grove")
}if(arguments[0]&&arguments[0].lang&&h.indexOf(arguments[0].lang)==-1){throw new Error("This plugin doesn't support the specified language at this point.")
}g=D;
this.debugMode=n
},supported:function(E,D){E=E||function(){};
D=D||function(){};
if(window.ApplePaySession&&typeof g!=="undefined"){var F=ApplePaySession.canMakePaymentsWithActiveCard(g.merchantID);
F.then(E);
return true
}else{D.call();
j("Apple Pay isn't supported");
return false
}},beginSession:function(M,I,D,G){if(I==null||D==null||G==null||!l(M.amount)||!s(M.frequency)){throw new Error("Please pass valid donationObject, success and failure callback functions..")
}var H=g.sessionURL;
var P=g.grove;
var K=g.displayName;
var F=y(M.amount,M.frequency,g.lang,K);
var J=new ApplePaySession(1,F);
var L=this;
var E=function E(R,S,Q){if(R==1){J.abort()
}if(R==2){J.completePayment(ApplePaySession.STATUS_FAILURE)
}S.call(this,Q)
};
var N=function N(R,S,Q){if(R==1){J.completeMerchantValidation(Q)
}if(R==2){S.call(this,Q)
}};
var O=function O(Q){Q.call(this)
};
J.onvalidatemerchant=function(Q){j("starting session.onvalidationmerchant");
j(Q);
var R=q(H,P,Q.validationURL,K);
R.then(function(S){if(S.status==="SUCCESS"){N(1,I,S.result)
}else{E(1,D,{type:Q.type,moreInfo:S.result})
}},function(S){j("Unable to fetch merchant session");
j("Merchant session service returned status: "+S.status+" : "+S.statusText);
E(1,D,{type:Q.type,moreInfo:S.status+" : "+S.statusText})
})
};
J.onpaymentauthorized=function(S){j("starting session.onpaymentauthorized");
j("NB: full shipping address available in event.payment.shippingContact object");
j(S);
d(J);
var Q=p(S.payment.billingContact);
var R=b(S.payment.shippingContact);
i=i.reduce(function(U,T){if(U.indexOf(T)<0){U.push(T)
}return U
},[]);
if([Q,R].every(function(T){return T==true
})){N(2,I,S.payment)
}else{E(2,D,{type:"invalidFields",moreInfo:i})
}i=[]
};
J.oncancel=function(Q){j("starting session.cancel");
j(Q);
O(G)
};
J.begin()
},end:function(D){var E=x();
if(E instanceof ApplePaySession){E.completePayment(D);
f()
}}}
}();